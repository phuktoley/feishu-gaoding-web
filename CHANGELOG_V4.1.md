# v4.1 版本更新说明

## 版本信息

- **版本号**: v4.1
- **发布日期**: 2026-01-05
- **分支名称**: v4.1

## 主要更新

### 1. 导出格式升级为 ZIP + XLSX（2026-01-05 更新）

将导出格式从 CSV 升级为 ZIP 压缩包，内含符合稿定设计标准的 XLSX 文件。

#### 修改前（旧格式）
- 导出格式：CSV 文件
- 文件名：`稿定设计-数据上传_YYYY-MM-DD.csv`

#### 修改后（新格式）
- 导出格式：ZIP 压缩包，内含 XLSX 文件
- 文件名：`稿定设计-数据上传_YYYY-MM-DD.zip`
- 内部文件：`稿定设计-数据上传.xlsx`

#### XLSX 文件结构
| 行号 | 内容 | 说明 |
|------|------|------|
| 第1行 | 警告说明 | 合并单元格 A1:Z1，包含稿定设计填写须知 |
| 第2行 | 表头 | 页面、文本_1、文本_2 |
| 第3行起 | 数据 | 页面1、主标题、副标题 |

#### 新增依赖
- `xlsx`: 用于生成 Excel 文件
- `jszip`: 用于创建 ZIP 压缩包

### 2. 字段映射关系

| 稿定设计字段 | 飞书表格字段 | 说明 |
|-------------|-------------|------|
| 页面 | 页面N | 格式为"页面1"、"页面2"... |
| 文本_1 | 主标题 | 封面主文案 |
| 文本_2 | 副标题 | 封面副文案 |

### 3. 界面更新

- 表格预览中"页面"列显示为"页面1"、"页面2"格式
- 使用说明更新为说明导出 ZIP 压缩包

### 4. 稿定设计模板兼容

生成的 XLSX 文件完全兼容稿定设计的批量套版模板格式：
- Sheet 名称：`文案表（横版）`
- 第一行合并单元格 A1:Z1 包含填写须知
- 表头和数据格式与官方模板一致

## 修改的文件

- `client/src/pages/Export.tsx` - 导出页面组件（重写导出逻辑）
- `package.json` - 新增 xlsx 和 jszip 依赖

## 使用方法

1. 访问"飞书数据"页面
2. 点击"导出稿定格式"按钮
3. 下载 ZIP 压缩包
4. 直接上传 ZIP 文件到稿定设计的批量套版功能

## 稿定设计格式说明

根据稿定设计官方要求：

1. 每一行表格的内容将填充成一份设计结果
2. 请不要增加、删除、修改表头内容
3. 请不要合并、拆分单元格
4. 请将用到的图片文件与 Excel 放在同一个文件夹中，打成压缩包后上传
5. 当前批量套版仅支持最多 148 行数据

## 兼容性

- ✅ 稿定设计批量套版（ZIP + XLSX 格式）
- ✅ 飞书多维表格数据
- ✅ 与稿定设计官方模板格式完全一致

## 测试状态

- [x] TypeScript 类型检查 ✅ 2026-01-05
- [x] 本地构建测试 ✅ 2026-01-05
- [x] 单元测试 ✅ 2026-01-05
- [x] XLSX 格式验证（与官方模板对比）✅ 2026-01-05
- [ ] 稿定设计导入验证（需用户手动验证）

---

**更新者**: Manus AI Agent  
**更新日期**: 2026-01-05
