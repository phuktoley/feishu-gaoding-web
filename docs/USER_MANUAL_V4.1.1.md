# 飞书-稿定设计自动化工具 用户手册 V4.1.1

## 目录

1. [产品概述](#产品概述)
2. [快速开始](#快速开始)
3. [功能说明](#功能说明)
4. [常见问题](#常见问题)
5. [版本历史](#版本历史)

---

## 产品概述

飞书-稿定设计自动化工具是一个连接飞书多维表格和稿定设计的自动化工具，帮助用户实现批量图片生成和管理的自动化流程。

### 核心功能

| 功能 | 说明 |
|------|------|
| 飞书数据读取 | 从飞书多维表格获取文案数据 |
| 导出稿定格式 | 将数据导出为稿定设计批量套版所需的XLSX格式 |
| 图片回传 | 将稿定设计生成的图片自动上传回飞书表格 |

### 工作流程

```
飞书多维表格 → 导出XLSX → 稿定设计批量套版 → 下载图片ZIP → 上传回飞书
```

---

## 快速开始

### 步骤1：配置飞书凭证

1. 登录[飞书开放平台](https://open.feishu.cn/)
2. 创建企业自建应用，获取 App ID 和 App Secret
3. 为应用添加以下权限：
   - `bitable:app:readonly` - 读取多维表格
   - `bitable:record` - 读写多维表格记录
   - `drive:drive:media` - 上传素材到云空间
4. 在应用中打开配置页面，填写凭证信息

### 步骤2：准备飞书多维表格

**重要**：确保你的飞书多维表格包含以下字段：

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| 封面主文案 | 文本 | 对应导出的"文本_1"列 |
| 封面副文案 | 文本 | 对应导出的"文本_2"列 |
| **封面图片** | **附件** | **用于存储上传的图片（必须创建）** |

> ⚠️ **注意**：如果你的表格中没有"封面图片"附件字段，图片上传功能将无法使用。请在飞书表格中添加一个附件类型的字段。

### 步骤3：导出数据到稿定设计

1. 点击"飞书数据"页面
2. 确认数据正确显示
3. 点击"导出稿定格式"按钮
4. 下载ZIP文件

### 步骤4：在稿定设计生成图片

1. 打开[稿定设计](https://www.gaoding.com/)
2. 选择一个模板，进入批量套版功能
3. 上传刚才下载的ZIP文件
4. 生成图片并下载

### 步骤5：上传图片回飞书

1. 点击"上传图片"页面
2. 上传稿定设计下载的ZIP文件
3. 确认图片解析正确
4. 点击"上传到飞书"

---

## 功能说明

### 飞书配置

配置页面用于设置飞书应用凭证和多维表格信息。

| 配置项 | 说明 | 示例 |
|--------|------|------|
| App ID | 飞书应用的唯一标识 | cli_a9dcabca84785cd1 |
| App Secret | 飞书应用的密钥 | D2UeA0Rgz... |
| App Token | 多维表格的Token | PJvZbmCDKa6iZnsn6Atc9m5fnWc |
| Table ID | 数据表的ID | tblJI8DTafcqas66 |
| 图片字段名称 | 存储图片的附件字段名 | 封面图片 |

**如何获取 App Token 和 Table ID**：

从多维表格URL中提取：
```
https://xxx.feishu.cn/base/{APP_TOKEN}?table={TABLE_ID}
```

### 飞书数据

数据页面显示从飞书表格读取的数据，包含三列：

| 列名 | 对应飞书字段 | 说明 |
|------|-------------|------|
| 页面 | 自动生成 | 序号，如"页面1"、"页面2" |
| 文本_1 | 封面主文案 | 主标题文案 |
| 文本_2 | 封面副文案 | 副标题文案 |

### 导出稿定格式

导出功能生成符合稿定设计批量套版要求的XLSX文件：

**文件结构**：
- ZIP文件名：`稿定设计-数据上传_YYYY-MM-DD.zip`
- 内含XLSX文件：`稿定设计-数据上传.xlsx`

**XLSX格式**：
- 第1行：稿定设计填写须知（合并单元格）
- 第2行：表头（页面、文本_1、文本_2）
- 第3行起：数据行

### 上传图片

上传功能将稿定设计生成的图片回传到飞书表格。

**支持的文件格式**：
- ZIP文件（从稿定设计下载）
- 图片命名格式：页面1.png、页面2.png...

**上传流程**：
1. 解析ZIP文件中的图片
2. 按序号匹配飞书记录
3. 上传图片到飞书云存储
4. 更新记录的附件字段

---

## 常见问题

### Q1: 上传图片失败，显示"字段名未找到"

**原因**：飞书表格中没有配置的附件字段。

**解决方案**：
1. 打开飞书多维表格
2. 点击"+"添加新字段
3. 选择字段类型为"附件"
4. 将字段名设为"封面图片"（或与配置页面中设置的名称一致）
5. 重新尝试上传

### Q2: 导出的XLSX文件在稿定设计中无法识别

**原因**：XLSX格式不兼容。

**解决方案**：
- 确保使用最新版本的应用
- V4.1.1版本已修复XLSX格式兼容性问题

### Q3: 测试连接失败

**可能原因**：
1. App ID 或 App Secret 错误
2. 应用权限不足
3. App Token 或 Table ID 错误

**解决方案**：
1. 检查凭证是否正确复制
2. 确认应用已添加必要权限
3. 确认表格URL中的Token和ID

### Q4: 图片数量与记录数量不匹配

**说明**：系统会按顺序匹配，多余的图片将被忽略。

**建议**：确保稿定设计生成的图片数量与飞书记录数量一致。

---

## 版本历史

### V4.1.1 (2026-01-05)

**Bug修复**：
- 修复导出XLSX缺少"文本_2"列的问题
- 改进飞书上传错误处理和日志

**文档更新**：
- 新增端到端测试用例集合
- 完善用户手册

### V4.1 (2026-01-04)

**新功能**：
- 支持自定义图片字段名称
- 改进XLSX格式兼容性

### V4.0 (2026-01-03)

**初始版本**：
- 飞书配置管理
- 数据读取和导出
- 图片上传功能

---

## 技术支持

如有问题，请联系开发团队或查看项目文档：
- GitHub: https://github.com/phuktoley/feishu-gaoding-web
- 分支: v4.1
